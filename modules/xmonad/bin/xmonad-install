#!/bin/bash

# xmonad installation script
#
# Based on content from
#     https://github.com/davidbrewer/xmonad-ubuntu-conf/blob/master/start-xmonad

XMONAD_DIR=$( builtin cd $(dirname ${BASH_SOURCE:-$0})/.. && pwd )

PACKAGES='
conky
dmenu
dzen2
hsetroot
fonts-inconsolata
trayer
xcompmgr
xmonad
xscreensaver
'

SUCKLESS_REPO=chilicuil/sucklesstools

echo "Installing packages"

# Add repo which contains xft-enabled versions of dmenu, dzen2
# See https://launchpad.net/~chilicuil/+archive/sucklesstools
#sudo apt-add-repository ppa:${SUCKLESS_REPO}

sudo apt-get update

sudo apt-get install ${PACKAGES}

echo "Creating xsession configuration"
desktop_file=/usr/share/xsessions/xmonad.desktop
if [[ -e ${desktop_file} ]]; then
    if [[ -e ${desktop_file}.orig ]]; then
        echo "Warning: ${desktop_file}.orig already exists - not overwriting"
    else
        sudo mv ${desktop_file} ${desktop_file}.orig
    fi
fi

tmp=$(mktemp -d)
cp ${XMONAD_DIR}/config/xmonad.desktop ${tmp}
sudo cp -v ${tmp}/xmonad.desktop ${desktop_file}
sudo chmod a+r ${desktop_file}
rm -rf $tmp

#sudo apt-add-repository --remove ${SUCKLESS_REPO}
sudo apt-get update

echo 'xmonad installation complete'

